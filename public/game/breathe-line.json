{
  "title": "Breathe Line - Indoor Air Quality Escape",
  "description": "A cooperative educational escape game about indoor air quality and ventilation systems",
  "timer": {
    "durationMs": 1800000,
    "penaltyAfterMs": 1200000,
    "penaltyPerMinute": 1
  },
  "audio": {
    "bgm": "chiptune_loop_01",
    "sfx": {
      "click": "click_01",
      "unlock": "unlock_01",
      "error": "buzz_01"
    }
  },
  "roles": ["Analyst", "Tech", "Operator", "Logistician"],
  "ui": {
    "adjacencyRange": 3,
    "controls": {
      "move": "Click or WASD/ZQSD",
      "interact": "* (asterisk) or Enter (when adjacent)",
      "chat": "Type in chat panel",
      "debug": "+ to toggle debug mode"
    }
  },
  "scoring": {
    "baseScore": 100,
    "maxHints": 2,
    "hintCost": 10,
    "errorPenalty": 2,
    "miniGameBonus": 50
  },
  "debugSolo": {
    "enabled": true,
    "latchMs": 5000,
    "showStickyNotes": true,
    "roleSwitch": true,
    "hotspots": true
  },
  "rooms": [
    {
      "id": "R1",
      "name": "üéõÔ∏è Control Room - Station de Contr√¥le",
      "grid": { "cols": 14, "rows": 10 },
      "spawn": { "x": 7, "y": 8 },
      "objects": [
        {
          "id": "swA",
          "type": "switch",
          "name": "üîß Switch Alpha",
          "x": 3,
          "y": 3,
          "state": "off",
          "roleLock": "Tech",
          "cooldownMs": 300,
          "ledId": "ledA",
          "requires": ["step2_enterCode"],
          "tooltip": "üîß Valve Alpha (Entr√©e Air)\nüîí Acc√®s: Tech uniquement\nüí° SYNC OBLIGATOIRE avec Valve Beta!\n‚è±Ô∏è Fen√™tre: 3 secondes max\nüîó Pr√©requis: Terminal r√©activ√©",
          "miniGame": "simon",
          "debriefing": {
            "title": "Valve Alpha activ√©e!",
            "explanation": "La Valve A contr√¥le l'entr√©e d'air frais. Elle doit √™tre ouverte simultan√©ment avec la Valve B (extraction) pour maintenir l'√©quilibre de pression dans la station.",
            "didYouKnow": "Les mini-jeux de type Simon testent votre m√©moire de travail, une comp√©tence essentielle pour les op√©rateurs de syst√®mes complexes!",
            "realWorld": "Dans les sous-marins et stations spatiales, chaque valve est critique. Les protocoles de s√©curit√© exigent toujours une double v√©rification.",
            "unlocked": "Attendez que Valve Beta soit aussi activ√©e"
          }
        },
        {
          "id": "swB",
          "type": "switch",
          "name": "üîß Switch Beta",
          "x": 11,
          "y": 3,
          "state": "off",
          "roleLock": "Tech",
          "cooldownMs": 300,
          "ledId": "ledB",
          "requires": ["step2_enterCode"],
          "tooltip": "üîß Valve Beta (Extraction Air)\nüîí Acc√®s: Tech uniquement\nüí° SYNC avec Valve Alpha < 3s!\n‚ö†Ô∏è D√©s√©quilibre = DANGER\nüîó Pr√©requis: Terminal r√©activ√©",
          "miniGame": "simon",
          "debriefing": {
            "title": "Valves synchronis√©es!",
            "explanation": "Parfait! Les deux valves sont ouvertes en synchronisation. L'air frais entre par A pendant que l'air vici√© sort par B. L'√©quilibre de pression est maintenu, √©vitant tout risque pour la structure.",
            "didYouKnow": "Dans les avions, la pressurisation de la cabine fonctionne sur le m√™me principe. L'air est constamment renouvel√© tout en maintenant une pression stable.",
            "realWorld": "Les datacenters utilisent des syst√®mes de ventilation similaires pour √©vacuer la chaleur tout en maintenant la pression. Une panne peut co√ªter des millions!",
            "unlocked": "Panneau de Validation accessible"
          }
        },
        {
          "id": "ledA",
          "type": "led",
          "name": "üí° LED Alpha",
          "x": 3,
          "y": 2,
          "state": "red",
          "label": "OFF",
          "bindsTo": "swA"
        },
        {
          "id": "ledB",
          "type": "led",
          "name": "üí° LED Beta",
          "x": 11,
          "y": 2,
          "state": "red",
          "label": "OFF",
          "bindsTo": "swB"
        },
        {
          "id": "panelData",
          "type": "panel",
          "name": "üìä Panneau de Donn√©es CO‚ÇÇ",
          "x": 2,
          "y": 7,
          "roleLock": "Analyst",
          "panel": {
            "title": "üìä DIAGNOSTIC CO‚ÇÇ - 4 CAPTEURS",
            "text": "‚ö†Ô∏è ALERTE SYST√àME D√âTECT√âE\n\nüìä RELEV√âS DES CAPTEURS:\n\nCapteur A (Salle repos): 980 ppm ‚úì\nCapteur B (Lab biologie): 1450 ppm ‚ö†Ô∏è\nCapteur C (Contr√¥le): 1050 ppm ‚ö†Ô∏è\nCapteur D (Serre): 720 ppm ‚úì\n\nüéØ MISSION:\nIdentifiez le capteur en zone CRITIQUE (>1400 ppm)\n\nüìö RAPPEL SEUILS:\n< 800 ppm: OPTIMAL\n800-1000 ppm: ACCEPTABLE\n1000-1400 ppm: ALERTE\n> 1400 ppm: CRITIQUE!\n\nüí° Le code zone = Lettre capteur + valeur/100\nExemple: Si Capteur B (1450) est critique\n‚Üí Code = B + (1450/100) = B14 (arrondi)\n\nüì° TRANSMETTEZ ce code √† l'Operator!",
            "code": "B14",
            "debriefing": {
              "title": "Diagnostic CO‚ÇÇ r√©ussi!",
              "explanation": "Le CO‚ÇÇ (dioxyde de carbone) s'accumule naturellement dans les espaces clos. √Ä partir de 1000 ppm, il affecte la concentration. Au-del√† de 1400 ppm, c'est dangereux pour la sant√©.",
              "didYouKnow": "Dans les salles de classe mal ventil√©es, le CO‚ÇÇ peut atteindre 1800 ppm, r√©duisant les performances scolaires de 60%! C'est pourquoi a√©rer est crucial.",
              "realWorld": "Les capteurs CO‚ÇÇ sont d√©sormais install√©s dans de nombreux b√¢timents publics depuis la pand√©mie. Ils permettent d'optimiser la ventilation en temps r√©el.",
              "unlocked": "Code zone critique transmis: B14"
            }
          },
          "tooltip": "üìä Panneau de Donn√©es CO‚ÇÇ\nüîí Acc√®s: Analyst uniquement\nüí° Astuce: Lisez attentivement et notez le code d'activation!\nüìû Communication: Utilisez le chat pour transmettre l'info",
          "miniGame": "co2graph"
        },
        {
          "id": "consoleR1",
          "type": "console",
          "name": "‚å®Ô∏è Console d'Activation",
          "x": 12,
          "y": 7,
          "console": {
            "accept": "codeN",
            "validFormatRegex": "^[A-D][0-9]{1,2}$",
            "correctCode": "B14"
          },
          "roleLock": "Operator",
          "cooldownMs": 250,
          "requires": ["step1_readPanel"],
          "tooltip": "‚å®Ô∏è Terminal de R√©activation HVAC\nüîí Acc√®s: Operator uniquement\nüí° Demandez le code zone √† l'Analyst!\nüî¢ Format: Lettre + Nombre (ex: B14)\n‚ö†Ô∏è Erreur = p√©nalit√© temps\nüîó Pr√©requis: Diagnostic compl√©t√©",
          "miniGame": "wiring",
          "debriefing": {
            "title": "Filtres HVAC r√©activ√©s!",
            "explanation": "Les syst√®mes HVAC (Heating, Ventilation, Air Conditioning) renouvellent l'air int√©rieur en aspirant l'air vici√© riche en CO‚ÇÇ, le filtrant, puis injectant de l'air frais. Un bon HVAC renouvelle l'air 2-3 fois par heure.",
            "didYouKnow": "Les b√¢timents modernes sont tr√®s √©tanches pour l'efficacit√© √©nerg√©tique, mais cela pi√®ge le CO‚ÇÇ. Sans HVAC efficace, le niveau peut monter tr√®s rapidement!",
            "realWorld": "Depuis la pand√©mie, les syst√®mes HVAC ont √©t√© am√©lior√©s dans de nombreux √©tablissements. C'est devenu un crit√®re de qualit√© des b√¢timents.",
            "unlocked": "Valves m√©caniques A et B d√©bloqu√©es"
          }
        },
        {
          "id": "confirmPanel",
          "type": "panel",
          "name": "‚úÖ Panneau de Confirmation",
          "x": 7,
          "y": 2,
          "roleLock": "Analyst",
          "requires": ["step3_switches"],
          "panel": {
            "title": "‚úÖ VALIDATION SYST√àME",
            "text": "üìã RAPPORT FINAL:\n\n‚úì Diagnostic: Zone B identifi√©e (1450 ppm)\n‚úì HVAC: Filtres r√©activ√©s\n‚úì Valve A: Synchronis√©e\n‚úì Valve B: Synchronis√©e\n\nüìä STATUT ACTUEL:\nNiveau CO‚ÇÇ: En baisse\nD√©bit air: 150 m¬≥/h\nTemp√©rature: 18¬∞C ‚úì\nPression: √âquilibr√©e ‚úì\n\nüéØ QUESTION DE VALIDATION:\nCombien de temps faut-il pour atteindre 400 ppm?\n\nDonn√©es:\n- Volume salle: 300 m¬≥\n- D√©bit HVAC: 150 m¬≥/h\n- Renouvellement complet: ?\n\nR√©ponse: 2-3 heures\n\nüëâ Appuyez sur [E] pour valider",
            "code": "VALIDATED",
            "debriefing": {
              "title": "Mission R1 accomplie!",
              "explanation": "En synchronisant les valves A et B, vous avez √©vit√© un d√©s√©quilibre de pression. Dans les syst√®mes pressuris√©s, ouvrir une seule valve cr√©erait soit une surpression (dommages) soit une d√©pression (implosion). C'est le m√™me principe pour les sas de stations spatiales!",
              "didYouKnow": "90% de notre temps est pass√© en int√©rieur. Une bonne qualit√© d'air am√©liore les performances scolaires (+15%), la productivit√© (+20%) et la sant√© g√©n√©rale. A√©rez votre chambre 10 min/jour minimum!",
              "realWorld": "Les b√¢timents intelligents utilisent d√©sormais des capteurs CO‚ÇÇ pour ajuster automatiquement la ventilation. Cela √©conomise 30% d'√©nergie tout en gardant un air sain.",
              "unlocked": "üö™ Sortie vers Lab Filtration d√©verrouill√©e"
            }
          },
          "tooltip": "‚úÖ Panneau de Validation\nüîí Acc√®s: Analyst uniquement\nüí° V√©rifiez que tout est stabilis√©!\nüîó Pr√©requis: Valves synchronis√©es",
          "miniGame": "co2graph"
        },
        {
          "id": "doorR1",
          "type": "door",
          "name": "üö™ Sortie vers Salle de Ventilation",
          "x": 13,
          "y": 5,
          "open": false,
          "lockedBy": ["R1_complete"]
        }
      ],
      "puzzles": [
        {
          "id": "step1_readPanel",
          "type": "infoSplit",
          "sourcePanel": "panelData",
          "targetConsole": "panelData",
          "codeFormat": "NNNN",
          "soloNote": true
        },
        {
          "id": "step2_enterCode",
          "type": "infoSplit",
          "sourcePanel": "panelData",
          "targetConsole": "consoleR1",
          "codeFormat": "NNNN",
          "soloNote": true,
          "requires": ["step1_readPanel"]
        },
        {
          "id": "step3_switches",
          "type": "multiSwitch",
          "ids": ["swA", "swB"],
          "simultaneous": true,
          "playersRequired": 2,
          "windowMs": 3000,
          "distanceGate": { "minTiles": 3 },
          "debugSolo": { "latched": true, "latchMs": 5000 },
          "requires": ["step2_enterCode"]
        },
        {
          "id": "step4_confirm",
          "type": "infoSplit",
          "sourcePanel": "confirmPanel",
          "targetConsole": "confirmPanel",
          "codeFormat": "CONFIRM",
          "soloNote": true,
          "requires": ["step3_switches"]
        }
      ],
      "successCondition": "step1_readPanel.success && step2_enterCode.success && step3_switches.success && step4_confirm.success",
      "outputs": {
        "keys": ["K1"],
        "codePart": "3"
      },
      "pedagogy": {
        "title": "ü´Å Comprendre le CO‚ÇÇ et les Seuils d'Alerte",
        "lines": [
          "üí® LE CO‚ÇÇ (DIOXYDE DE CARBONE):",
          "Le CO‚ÇÇ est un gaz incolore et inodore produit par la respiration humaine.",
          "En espace clos, sa concentration augmente rapidement sans ventilation.",
          "",
          "üìä SEUILS DE R√âF√âRENCE:",
          "‚Ä¢ 400 ppm: Air ext√©rieur (r√©f√©rence naturelle)",
          "‚Ä¢ 600-800 ppm: Bon niveau pour int√©rieur",
          "‚Ä¢ 1000 ppm: SEUIL D'ALERTE - Ventilation requise",
          "‚Ä¢ 1500+ ppm: Niveau critique - Risques pour la sant√©",
          "",
          "üß† IMPACTS SUR LA SANT√â:",
          "‚Ä¢ 1000-1500 ppm: Fatigue, maux de t√™te l√©gers",
          "‚Ä¢ 1500-2000 ppm: Baisse concentration (-60%)",
          "‚Ä¢ 2000+ ppm: Somnolence, malaise",
          "",
          "üí° POURQUOI C'EST IMPORTANT:",
          "On passe 90% de notre temps en int√©rieur!",
          "L'air int√©rieur est souvent 5x plus pollu√© que l'ext√©rieur.",
          "Une bonne ventilation am√©liore les performances cognitives de 60%.",
          "",
          "üè´ APPLICATIONS R√âELLES:",
          "‚Ä¢ √âcoles: Meilleurs r√©sultats scolaires avec bon air",
          "‚Ä¢ Bureaux: Productivit√© accrue",
          "‚Ä¢ Maisons: Sant√© et bien-√™tre"
        ],
        "quiz": {
          "q": "üéØ √Ä partir de quel niveau de CO‚ÇÇ doit-on d√©clencher une alerte de ventilation?",
          "choices": ["400 ppm (air ext√©rieur)", "800 ppm (bon niveau)", "1000 ppm (seuil critique)", "1500 ppm (danger)"],
          "correctIndex": 2
        },
        "analystContext": "üéì En tant qu'Analyst, vous avez identifi√© le seuil critique √† partir des donn√©es capteurs et communiqu√© l'information vitale √† votre √©quipe!"
      },
      "hint": "üí° INDICE: Le seuil affich√© sur le panneau CO‚ÇÇ aide √† former le code d'activation!"
    },
    {
      "id": "R2",
      "name": "Ventilation Room",
      "grid": { "cols": 12, "rows": 8 },
      "spawn": { "x": 6, "y": 6 },
      "objects": [
        {
          "id": "valveA",
          "type": "valve",
          "name": "Valve A",
          "x": 3,
          "y": 4,
          "state": "closed",
          "roleLock": "Operator",
          "cooldownMs": 500,
          "tooltip": "Valve A - Operator only",
          "miniGame": "timing"
        },
        {
          "id": "valveB",
          "type": "valve",
          "name": "Valve B",
          "x": 5,
          "y": 4,
          "state": "closed",
          "roleLock": "Operator",
          "cooldownMs": 500,
          "tooltip": "Valve B - Operator only",
          "miniGame": "timing"
        },
        {
          "id": "valveC",
          "type": "valve",
          "name": "Valve C",
          "x": 7,
          "y": 4,
          "state": "closed",
          "roleLock": "Operator",
          "cooldownMs": 500,
          "tooltip": "Valve C - Operator only",
          "miniGame": "timing"
        }
      ],
      "puzzles": [
        {
          "id": "multiValve_R2",
          "type": "multiValve",
          "ids": ["valveA", "valveB", "valveC"],
          "simultaneous": true,
          "playersRequired": 3,
          "windowMs": 3000,
          "distanceGate": { "minTiles": 3 },
          "debugSolo": { "latched": true, "latchMs": 5000 }
        }
      ],
      "successCondition": "multiValve_R2.success",
      "outputs": {
        "keys": ["K2"],
        "codePart": "4"
      },
      "pedagogy": {
        "title": "Ventilation System Activation",
        "lines": [
          "Proper ventilation involves controlling air flow through various valves.",
          "Opening the correct valves simultaneously can activate the system."
        ],
        "quiz": {
          "q": "How many valves need to be opened simultaneously to activate the ventilation system?",
          "choices": ["2", "3", "4", "5"],
          "correctIndex": 1
        },
        "operatorContext": "As an Operator, you coordinated the opening of the valves to activate the ventilation system."
      },
      "hint": "Check the correct sequence and timing for the valves."
    },
    {
      "id": "R3",
      "name": "Filtration Room",
      "grid": { "cols": 12, "rows": 8 },
      "spawn": { "x": 6, "y": 6 },
      "objects": [
        {
          "id": "filterA",
          "type": "switch",
          "name": "HEPA Filter A",
          "x": 3,
          "y": 3,
          "state": "off",
          "roleLock": "Tech",
          "cooldownMs": 300,
          "tooltip": "HEPA Filter A - Tech only"
        },
        {
          "id": "filterB",
          "type": "switch",
          "name": "Carbon Filter B",
          "x": 6,
          "y": 3,
          "state": "off",
          "roleLock": "Tech",
          "cooldownMs": 300,
          "tooltip": "Carbon Filter B - Tech only"
        },
        {
          "id": "filterC",
          "type": "switch",
          "name": "UV Filter C",
          "x": 9,
          "y": 3,
          "state": "off",
          "roleLock": "Tech",
          "cooldownMs": 300,
          "tooltip": "UV Filter C - Tech only"
        },
        {
          "id": "sequencePanel",
          "type": "panel",
          "name": "Filter Sequence Panel",
          "x": 3,
          "y": 6,
          "roleLock": "Analyst",
          "panel": {
            "title": "Filter Activation Sequence",
            "text": "CRITICAL: Filters must be activated in correct order:\n1. HEPA (Particulate removal)\n2. Carbon (VOC absorption)\n3. UV (Microbial sterilization)\n\nIncorrect sequence may damage equipment.",
            "code": "ACB"
          },
          "tooltip": "Filter Sequence Panel - Analyst only"
        },
        {
          "id": "airQualityMonitor",
          "type": "console",
          "name": "Air Quality Monitor",
          "x": 9,
          "y": 6,
          "console": {
            "accept": "code3",
            "validFormatRegex": "^[A-Z]{3}$",
            "correctCode": "ACB"
          },
          "roleLock": "Operator",
          "cooldownMs": 250,
          "tooltip": "Air Quality Monitor - Operator only"
        },
        {
          "id": "doorR3",
          "type": "door",
          "name": "Exit Door",
          "x": 11,
          "y": 6,
          "open": false,
          "lockedBy": ["R3_complete"]
        }
      ],
      "puzzles": [
        {
          "id": "sequence_R3",
          "type": "sequence",
          "order": ["filterA", "filterB", "filterC"],
          "resetOnError": true,
          "lockMs": 3000,
          "windowMs": 5000
        },
        {
          "id": "infoSplit_R3",
          "type": "infoSplit",
          "sourcePanel": "sequencePanel",
          "targetConsole": "airQualityMonitor",
          "codeFormat": "AAA",
          "soloNote": true
        }
      ],
      "successCondition": "sequence_R3.success && airQualityMonitor.correct",
      "outputs": {
        "keys": ["K3"],
        "codePart": "7"
      },
      "pedagogy": {
        "title": "Multi-Stage Air Filtration",
        "lines": [
          "Modern air purification uses multiple filter stages:",
          "HEPA filters capture 99.97% of particles ‚â•0.3Œºm (dust, pollen, bacteria).",
          "Activated carbon filters absorb VOCs and odors.",
          "UV-C light (254nm) inactivates viruses and bacteria.",
          "Correct sequence order prevents filter saturation and maximizes efficiency."
        ],
        "quiz": {
          "q": "What percentage of particles does a HEPA filter capture?",
          "choices": ["95%", "99%", "99.97%", "100%"],
          "correctIndex": 2
        },
        "techContext": "As a Tech, you activated the multi-stage filtration system in the correct sequence."
      },
      "hint": "Read the sequence panel carefully. The order matters for filter efficiency."
    },
    {
      "id": "EXIT",
      "name": "Emergency Exit",
      "grid": { "cols": 12, "rows": 8 },
      "spawn": { "x": 6, "y": 6 },
      "objects": [
        {
          "id": "finalDoor",
          "type": "door",
          "name": "Emergency Exit Door",
          "x": 6,
          "y": 2,
          "open": false,
          "lockedBy": ["finalCode"]
        },
        {
          "id": "exitPanel",
          "type": "panel",
          "name": "Exit Instructions",
          "x": 3,
          "y": 5,
          "roleLock": "Analyst",
          "panel": {
            "title": "Emergency Exit Protocol",
            "text": "EVACUATION CODE REQUIRED\n\nCombine all code parts collected from previous rooms.\nFormat: XXXX (4 digits)\n\nCode parts obtained:\nR1: [Part 1]\nR2: [Part 2]\nR3: [Part 3]",
            "code": "info"
          },
          "tooltip": "Exit Instructions - Analyst only"
        },
        {
          "id": "exitConsole",
          "type": "console",
          "name": "Exit Console",
          "x": 9,
          "y": 5,
          "console": {
            "accept": "finalCode",
            "validFormatRegex": "^[0-9]{4}$",
            "correctCode": "7347"
          },
          "roleLock": "Operator",
          "cooldownMs": 250,
          "tooltip": "Exit Console - Enter evacuation code"
        },
        {
          "id": "airQualityDisplay",
          "type": "panel",
          "name": "Final Air Quality Report",
          "x": 6,
          "y": 7,
          "panel": {
            "title": "Mission Success",
            "text": "‚úì CO‚ÇÇ levels normalized: 450 ppm\n‚úì Ventilation system: ACTIVE\n‚úì Filtration system: OPERATIONAL\n‚úì Air quality: EXCELLENT\n\nYou have successfully restored indoor air quality!",
            "code": "success"
          },
          "tooltip": "Air Quality Report"
        }
      ],
      "puzzles": [
        {
          "id": "finalCode_puzzle",
          "type": "infoSplit",
          "sourcePanel": "exitPanel",
          "targetConsole": "exitConsole",
          "codeFormat": "NNNN",
          "soloNote": true
        }
      ],
      "successCondition": "exitConsole.correct",
      "outputs": {
        "victory": true
      },
      "pedagogy": {
        "title": "Indoor Air Quality - Mission Complete",
        "lines": [
          "Congratulations! You've learned the fundamentals of indoor air quality management:",
          "‚Ä¢ CO‚ÇÇ monitoring and threshold alerts (1000 ppm)",
          "‚Ä¢ Mechanical ventilation systems and airflow control",
          "‚Ä¢ Multi-stage air filtration (HEPA, Carbon, UV)",
          "‚Ä¢ Importance of proper maintenance and monitoring",
          "",
          "Real-world impact:",
          "‚Ä¢ Better air quality improves cognitive performance by 60%",
          "‚Ä¢ Reduces respiratory illnesses and allergies",
          "‚Ä¢ Essential for schools, offices, and homes",
          "",
          "Remember: Fresh air is not a luxury, it's a necessity!"
        ],
        "quiz": {
          "q": "What is the main benefit of good indoor air quality?",
          "choices": [
            "Lower energy costs",
            "Better health and cognitive performance",
            "Prettier rooms",
            "Louder ventilation"
          ],
          "correctIndex": 1
        },
        "allRolesContext": "As a team, you successfully restored indoor air quality through collaboration and problem-solving!"
      },
      "hint": "Combine the code parts from R1 (3), R2 (4), and R3 (7) with the initial digit 7."
    }
  ]
}
