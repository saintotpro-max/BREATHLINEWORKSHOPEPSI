{
  "title": "Breathe Line - Indoor Air Quality Escape",
  "description": "A cooperative educational escape game about indoor air quality and ventilation systems",
  "timer": {
    "durationMs": 1800000,
    "penaltyAfterMs": 1200000,
    "penaltyPerMinute": 1
  },
  "audio": {
    "bgm": "chiptune_loop_01",
    "sfx": {
      "click": "click_01",
      "unlock": "unlock_01",
      "error": "buzz_01"
    }
  },
  "roles": ["Analyst", "Tech", "Operator"],
  "ui": {
    "adjacencyRange": 3,
    "controls": {
      "move": "Click or WASD/ZQSD",
      "interact": "* (asterisk) or Enter (when adjacent)",
      "chat": "Type in chat panel",
      "debug": "+ to toggle debug mode"
    }
  },
  "scoring": {
    "baseScore": 100,
    "maxHints": 2,
    "hintCost": 10,
    "errorPenalty": 2,
    "miniGameBonus": 50
  },
  "debugSolo": {
    "enabled": true,
    "latchMs": 5000,
    "showStickyNotes": true,
    "roleSwitch": true,
    "hotspots": true
  },
  "rooms": [
    {
      "id": "R1",
      "name": "ğŸ›ï¸ Control Room - Station de ContrÃ´le",
      "grid": { "cols": 14, "rows": 10 },
      "spawn": { "x": 7, "y": 8 },
      "objects": [
        {
          "id": "swA",
          "type": "switch",
          "name": "ğŸ”§ Switch Alpha",
          "x": 2,
          "y": 3,
          "state": "off",
          "roleLock": "Tech",
          "cooldownMs": 300,
          "ledId": "ledA",
          "requires": ["step2_enterCode"],
          "tooltip": "ğŸ”§ Valve Alpha (EntrÃ©e Air)\nğŸ”’ AccÃ¨s: Tech uniquement\nğŸ’¡ SYNC OBLIGATOIRE avec Valve Beta!\nâ±ï¸ FenÃªtre: 3 secondes max\nğŸ”— PrÃ©requis: Terminal rÃ©activÃ©",
          "miniGame": "simon",
          "debriefing": {
            "title": "Valve Alpha activÃ©e!",
            "explanation": "La Valve A contrÃ´le l'entrÃ©e d'air frais. Elle doit Ãªtre ouverte simultanÃ©ment avec la Valve B (extraction) pour maintenir l'Ã©quilibre de pression dans la station.",
            "didYouKnow": "Les mini-jeux de type Simon testent votre mÃ©moire de travail, une compÃ©tence essentielle pour les opÃ©rateurs de systÃ¨mes complexes!",
            "realWorld": "Dans les sous-marins et stations spatiales, chaque valve est critique. Les protocoles de sÃ©curitÃ© exigent toujours une double vÃ©rification.",
            "unlocked": "Attendez que Valve Beta soit aussi activÃ©e"
          }
        },
        {
          "id": "swB",
          "type": "switch",
          "name": "ğŸ”§ Switch Beta",
          "x": 12,
          "y": 3,
          "state": "off",
          "roleLock": "Tech",
          "cooldownMs": 300,
          "ledId": "ledB",
          "requires": ["step2_enterCode"],
          "tooltip": "ğŸ”§ Valve Beta (Extraction Air)\nğŸ”’ AccÃ¨s: Tech uniquement\nğŸ’¡ SYNC avec Valve Alpha < 3s!\nâš ï¸ DÃ©sÃ©quilibre = DANGER\nğŸ”— PrÃ©requis: Terminal rÃ©activÃ©",
          "miniGame": "simon",
          "debriefing": {
            "title": "Valves synchronisÃ©es!",
            "explanation": "Parfait! Les deux valves sont ouvertes en synchronisation. L'air frais entre par A pendant que l'air viciÃ© sort par B. L'Ã©quilibre de pression est maintenu, Ã©vitant tout risque pour la structure.",
            "didYouKnow": "Dans les avions, la pressurisation de la cabine fonctionne sur le mÃªme principe. L'air est constamment renouvelÃ© tout en maintenant une pression stable.",
            "realWorld": "Les datacenters utilisent des systÃ¨mes de ventilation similaires pour Ã©vacuer la chaleur tout en maintenant la pression. Une panne peut coÃ»ter des millions!",
            "unlocked": "Panneau de Validation accessible"
          }
        },
        {
          "id": "ledA",
          "type": "led",
          "name": "ğŸ’¡ LED Alpha",
          "x": 2,
          "y": 1,
          "state": "red",
          "label": "OFF",
          "bindsTo": "swA"
        },
        {
          "id": "ledB",
          "type": "led",
          "name": "ğŸ’¡ LED Beta",
          "x": 12,
          "y": 1,
          "state": "red",
          "label": "OFF",
          "bindsTo": "swB"
        },
        {
          "id": "panelData",
          "type": "panel",
          "name": "ğŸ“Š Panneau de DonnÃ©es COâ‚‚",
          "x": 1,
          "y": 6,
          "roleLock": "Analyst",
          "panel": {
            "title": "ğŸ“Š DIAGNOSTIC COâ‚‚ - 4 CAPTEURS",
            "text": "âš ï¸ ALERTE SYSTÃˆME DÃ‰TECTÃ‰E\n\nğŸ“Š RELEVÃ‰S DES CAPTEURS:\n\nCapteur A (Salle repos): 980 ppm âœ“\nCapteur B (Lab biologie): 1450 ppm âš ï¸\nCapteur C (ContrÃ´le): 1050 ppm âš ï¸\nCapteur D (Serre): 720 ppm âœ“\n\nğŸ¯ MISSION:\nIdentifiez le capteur en zone CRITIQUE (>1400 ppm)\n\nğŸ“š RAPPEL SEUILS:\n< 800 ppm: OPTIMAL\n800-1000 ppm: ACCEPTABLE\n1000-1400 ppm: ALERTE\n> 1400 ppm: CRITIQUE!\n\nğŸ’¡ Le code zone = Lettre capteur + valeur/100\nExemple: Si Capteur B (1450) est critique\nâ†’ Code = B + (1450/100) = B14 (arrondi)\n\nğŸ“¡ TRANSMETTEZ ce code Ã  l'Operator!",
            "code": "B14",
            "debriefing": {
              "title": "Diagnostic COâ‚‚ rÃ©ussi!",
              "explanation": "Le COâ‚‚ (dioxyde de carbone) s'accumule naturellement dans les espaces clos. Ã€ partir de 1000 ppm, il affecte la concentration. Au-delÃ  de 1400 ppm, c'est dangereux pour la santÃ©.",
              "didYouKnow": "Dans les salles de classe mal ventilÃ©es, le COâ‚‚ peut atteindre 1800 ppm, rÃ©duisant les performances scolaires de 60%! C'est pourquoi aÃ©rer est crucial.",
              "realWorld": "Les capteurs COâ‚‚ sont dÃ©sormais installÃ©s dans de nombreux bÃ¢timents publics depuis la pandÃ©mie. Ils permettent d'optimiser la ventilation en temps rÃ©el.",
              "unlocked": "Code zone critique transmis: B14"
            }
          },
          "tooltip": "ğŸ“Š Panneau de DonnÃ©es COâ‚‚\nğŸ”’ AccÃ¨s: Analyst uniquement\nğŸ’¡ Astuce: Lisez attentivement et notez le code d'activation!\nğŸ“ Communication: Utilisez le chat pour transmettre l'info",
          "miniGame": "co2graph"
        },
        {
          "id": "consoleR1",
          "type": "console",
          "name": "âŒ¨ï¸ Console d'Activation",
          "x": 13,
          "y": 6,
          "console": {
            "accept": "codeN",
            "validFormatRegex": "^[A-D][0-9]{1,2}$",
            "correctCode": "B14"
          },
          "roleLock": "Operator",
          "cooldownMs": 250,
          "requires": ["step1_readPanel"],
          "tooltip": "âŒ¨ï¸ Terminal de RÃ©activation HVAC\nğŸ”’ AccÃ¨s: Operator uniquement\nğŸ’¡ Demandez le code zone Ã  l'Analyst!\nğŸ”¢ Format: Lettre + Nombre (ex: B14)\nâš ï¸ Erreur = pÃ©nalitÃ© temps\nğŸ”— PrÃ©requis: Diagnostic complÃ©tÃ©",
          "miniGame": "wiring",
          "debriefing": {
            "title": "Filtres HVAC rÃ©activÃ©s!",
            "explanation": "Les systÃ¨mes HVAC (Heating, Ventilation, Air Conditioning) renouvellent l'air intÃ©rieur en aspirant l'air viciÃ© riche en COâ‚‚, le filtrant, puis injectant de l'air frais. Un bon HVAC renouvelle l'air 2-3 fois par heure.",
            "didYouKnow": "Les bÃ¢timents modernes sont trÃ¨s Ã©tanches pour l'efficacitÃ© Ã©nergÃ©tique, mais cela piÃ¨ge le COâ‚‚. Sans HVAC efficace, le niveau peut monter trÃ¨s rapidement!",
            "realWorld": "Depuis la pandÃ©mie, les systÃ¨mes HVAC ont Ã©tÃ© amÃ©liorÃ©s dans de nombreux Ã©tablissements. C'est devenu un critÃ¨re de qualitÃ© des bÃ¢timents.",
            "unlocked": "Valves mÃ©caniques A et B dÃ©bloquÃ©es"
          }
        },
        {
          "id": "confirmPanel",
          "type": "panel",
          "name": "âœ… Panneau de Confirmation",
          "x": 7,
          "y": 1,
          "roleLock": "Analyst",
          "requires": ["step3_switches"],
          "panel": {
            "title": "âœ… VALIDATION SYSTÃˆME",
            "text": "ğŸ“‹ RAPPORT FINAL:\n\nâœ“ Diagnostic: Zone B identifiÃ©e (1450 ppm)\nâœ“ HVAC: Filtres rÃ©activÃ©s\nâœ“ Valve A: SynchronisÃ©e\nâœ“ Valve B: SynchronisÃ©e\n\nğŸ“Š STATUT ACTUEL:\nNiveau COâ‚‚: En baisse\nDÃ©bit air: 150 mÂ³/h\nTempÃ©rature: 18Â°C âœ“\nPression: Ã‰quilibrÃ©e âœ“\n\nğŸ¯ QUESTION DE VALIDATION:\nCombien de temps faut-il pour atteindre 400 ppm?\n\nDonnÃ©es:\n- Volume salle: 300 mÂ³\n- DÃ©bit HVAC: 150 mÂ³/h\n- Renouvellement complet: ?\n\nRÃ©ponse: 2-3 heures\n\nğŸ‘‰ Appuyez sur [E] pour valider",
            "code": "VALIDATED",
            "debriefing": {
              "title": "Mission R1 accomplie!",
              "explanation": "En synchronisant les valves A et B, vous avez Ã©vitÃ© un dÃ©sÃ©quilibre de pression. Dans les systÃ¨mes pressurisÃ©s, ouvrir une seule valve crÃ©erait soit une surpression (dommages) soit une dÃ©pression (implosion). C'est le mÃªme principe pour les sas de stations spatiales!",
              "didYouKnow": "90% de notre temps est passÃ© en intÃ©rieur. Une bonne qualitÃ© d'air amÃ©liore les performances scolaires (+15%), la productivitÃ© (+20%) et la santÃ© gÃ©nÃ©rale. AÃ©rez votre chambre 10 min/jour minimum!",
              "realWorld": "Les bÃ¢timents intelligents utilisent dÃ©sormais des capteurs COâ‚‚ pour ajuster automatiquement la ventilation. Cela Ã©conomise 30% d'Ã©nergie tout en gardant un air sain.",
              "unlocked": "ğŸšª Sortie vers Lab Filtration dÃ©verrouillÃ©e"
            }
          },
          "tooltip": "âœ… Panneau de Validation\nğŸ”’ AccÃ¨s: Analyst uniquement\nğŸ’¡ VÃ©rifiez que tout est stabilisÃ©!\nğŸ”— PrÃ©requis: Valves synchronisÃ©es",
          "miniGame": "co2graph"
        },
        {
          "id": "doorR1",
          "type": "door",
          "name": "ğŸšª Sortie vers Salle de Ventilation",
          "x": 7,
          "y": 9,
          "open": false,
          "lockedBy": ["R1_complete"]
        }
      ],
      "puzzles": [
        {
          "id": "step1_readPanel",
          "type": "infoSplit",
          "sourcePanel": "panelData",
          "targetConsole": "panelData",
          "codeFormat": "LNN",
          "soloNote": true
        },
        {
          "id": "step2_enterCode",
          "type": "infoSplit",
          "sourcePanel": "panelData",
          "targetConsole": "consoleR1",
          "codeFormat": "LNN",
          "soloNote": true,
          "requires": ["step1_readPanel"]
        },
        {
          "id": "step3_switches",
          "type": "multiSwitch",
          "ids": ["swA", "swB"],
          "simultaneous": true,
          "playersRequired": 2,
          "windowMs": 3000,
          "distanceGate": { "minTiles": 3 },
          "debugSolo": { "latched": true, "latchMs": 5000 },
          "requires": ["step2_enterCode"]
        },
        {
          "id": "step4_confirm",
          "type": "infoSplit",
          "sourcePanel": "confirmPanel",
          "targetConsole": "confirmPanel",
          "codeFormat": "VALIDATED",
          "soloNote": true,
          "requires": ["step3_switches"]
        }
      ],
      "successCondition": "step1_readPanel.success && step2_enterCode.success && step3_switches.success && step4_confirm.success",
      "outputs": {
        "keys": ["K1"],
        "codePart": "3"
      },
      "pedagogy": {
        "title": "ğŸ« Comprendre le COâ‚‚ et les Seuils d'Alerte",
        "lines": [
          "ğŸ’¨ LE COâ‚‚ (DIOXYDE DE CARBONE):",
          "Le COâ‚‚ est un gaz incolore et inodore produit par la respiration humaine.",
          "En espace clos, sa concentration augmente rapidement sans ventilation.",
          "",
          "ğŸ“Š SEUILS DE RÃ‰FÃ‰RENCE:",
          "â€¢ 400 ppm: Air extÃ©rieur (rÃ©fÃ©rence naturelle)",
          "â€¢ 600-800 ppm: Bon niveau pour intÃ©rieur",
          "â€¢ 1000 ppm: SEUIL D'ALERTE - Ventilation requise",
          "â€¢ 1500+ ppm: Niveau critique - Risques pour la santÃ©",
          "",
          "ğŸ§  IMPACTS SUR LA SANTÃ‰:",
          "â€¢ 1000-1500 ppm: Fatigue, maux de tÃªte lÃ©gers",
          "â€¢ 1500-2000 ppm: Baisse concentration (-60%)",
          "â€¢ 2000+ ppm: Somnolence, malaise",
          "",
          "ğŸ’¡ POURQUOI C'EST IMPORTANT:",
          "On passe 90% de notre temps en intÃ©rieur!",
          "L'air intÃ©rieur est souvent 5x plus polluÃ© que l'extÃ©rieur.",
          "Une bonne ventilation amÃ©liore les performances cognitives de 60%.",
          "",
          "ğŸ« APPLICATIONS RÃ‰ELLES:",
          "â€¢ Ã‰coles: Meilleurs rÃ©sultats scolaires avec bon air",
          "â€¢ Bureaux: ProductivitÃ© accrue",
          "â€¢ Maisons: SantÃ© et bien-Ãªtre"
        ],
        "quiz": {
          "q": "ğŸ¯ Ã€ partir de quel niveau de COâ‚‚ doit-on dÃ©clencher une alerte de ventilation?",
          "choices": ["400 ppm (air extÃ©rieur)", "800 ppm (bon niveau)", "1000 ppm (seuil critique)", "1500 ppm (danger)"],
          "correctIndex": 2
        },
        "analystContext": "ğŸ“ En tant qu'Analyst, vous avez identifiÃ© le seuil critique Ã  partir des donnÃ©es capteurs et communiquÃ© l'information vitale Ã  votre Ã©quipe!"
      },
      "hint": "ğŸ’¡ INDICE: Le seuil affichÃ© sur le panneau COâ‚‚ aide Ã  former le code d'activation!"
    },
    {
      "id": "R2",
      "name": "Ventilation Room",
      "grid": { "cols": 12, "rows": 8 },
      "spawn": { "x": 6, "y": 6 },
      "objects": [
        {
          "id": "valveA",
          "type": "valve",
          "name": "Valve A",
          "x": 3,
          "y": 4,
          "state": "closed",
          "roleLock": "Operator",
          "cooldownMs": 500,
          "requires": ["step4_confirm"],
          "tooltip": "Valve A - Operator only\nğŸ”— Requires: R1 completed",
          "miniGame": "timing"
        },
        {
          "id": "valveB",
          "type": "valve",
          "name": "Valve B",
          "x": 5,
          "y": 4,
          "state": "closed",
          "roleLock": "Operator",
          "cooldownMs": 500,
          "requires": ["step4_confirm"],
          "tooltip": "Valve B - Operator only\nğŸ”— Requires: R1 completed",
          "miniGame": "timing"
        },
        {
          "id": "valveC",
          "type": "valve",
          "name": "Valve C",
          "x": 7,
          "y": 4,
          "state": "closed",
          "roleLock": "Operator",
          "cooldownMs": 500,
          "requires": ["step4_confirm"],
          "tooltip": "Valve C - Operator only\nğŸ”— Requires: R1 completed",
          "miniGame": "timing",
          "debriefing": {
            "title": "ğŸŒ¬ï¸ SystÃ¨me de Ventilation ActivÃ©!",
            "explanation": "FÃ©licitations! Vous avez activÃ© le systÃ¨me de ventilation Ã  3 zones. Chaque valve contrÃ´le une zone diffÃ©rente:\n\nâ€¢ Valve A: Zone Laboratoire (air propre requis)\nâ€¢ Valve B: Zone Habitation (confort thermique)\nâ€¢ Valve C: Zone Technique (Ã©vacuation chaleur)\n\nL'activation simultanÃ©e assure un renouvellement d'air homogÃ¨ne. Dans les bÃ¢timents modernes, on utilise la VMC (Ventilation MÃ©canique ContrÃ´lÃ©e).",
            "didYouKnow": "La VMC double flux peut rÃ©cupÃ©rer jusqu'Ã  90% de la chaleur de l'air sortant pour prÃ©chauffer l'air entrant. RÃ©sultat: Ã©conomie de 15-20% sur le chauffage! Les maisons passives utilisent ce principe pour consommer < 15 kWh/mÂ²/an.",
            "realWorld": "Les immeubles de bureaux modernes utilisent des systÃ¨mes BMS (Building Management System) qui ajustent automatiquement la ventilation selon le taux de COâ‚‚, l'occupation et la tempÃ©rature. RÃ©sultat: -30% de consommation Ã©nergÃ©tique vs ventilation constante.",
            "unlocked": "AccÃ¨s Filtration Room dÃ©verrouillÃ©"
          }
        },
        {
          "id": "doorR2_back_to_R1",
          "type": "door",
          "name": "ğŸšª Retour Control Room",
          "x": 6,
          "y": 1,
          "open": true,
          "to": "R1",
          "tooltip": "ğŸšª Retour vers Control Room\nâœ… Toujours accessible"
        },
        {
          "id": "doorR2_to_R3",
          "type": "door",
          "name": "ğŸšª Vers Filtration Room",
          "x": 6,
          "y": 7,
          "open": false,
          "lockedBy": ["multiValve_R2"],
          "to": "R3",
          "tooltip": "ğŸšª Porte vers Filtration Room\nğŸ”’ Activez les 3 valves pour dÃ©bloquer"
        }
      ],
      "puzzles": [
        {
          "id": "multiValve_R2",
          "type": "multiValve",
          "ids": ["valveA", "valveB", "valveC"],
          "simultaneous": true,
          "playersRequired": 3,
          "windowMs": 3000,
          "distanceGate": { "minTiles": 3 },
          "debugSolo": { "latched": true, "latchMs": 5000 }
        }
      ],
      "successCondition": "multiValve_R2.success",
      "outputs": {
        "keys": ["K2"],
        "codePart": "4"
      },
      "pedagogy": {
        "title": "Ventilation System Activation",
        "lines": [
          "Proper ventilation involves controlling air flow through various valves.",
          "Opening the correct valves simultaneously can activate the system."
        ],
        "quiz": {
          "q": "How many valves need to be opened simultaneously to activate the ventilation system?",
          "choices": ["2", "3", "4", "5"],
          "correctIndex": 1
        },
        "operatorContext": "As an Operator, you coordinated the opening of the valves to activate the ventilation system."
      },
      "hint": "Check the correct sequence and timing for the valves."
    },
    {
      "id": "R3",
      "name": "Filtration Room",
      "grid": { "cols": 12, "rows": 8 },
      "spawn": { "x": 6, "y": 6 },
      "objects": [
        {
          "id": "filterA",
          "type": "switch",
          "name": "HEPA Filter A",
          "x": 3,
          "y": 3,
          "state": "off",
          "roleLock": "Tech",
          "cooldownMs": 300,
          "tooltip": "HEPA Filter A - Tech only\nâš ï¸ Check sequence order first!"
        },
        {
          "id": "filterB",
          "type": "switch",
          "name": "Carbon Filter B",
          "x": 6,
          "y": 3,
          "state": "off",
          "roleLock": "Tech",
          "cooldownMs": 300,
          "tooltip": "Carbon Filter B - Tech only\nâš ï¸ Check sequence order first!"
        },
        {
          "id": "filterC",
          "type": "switch",
          "name": "UV Filter C",
          "x": 9,
          "y": 3,
          "state": "off",
          "roleLock": "Tech",
          "cooldownMs": 300,
          "tooltip": "UV Filter C - Tech only\nâš ï¸ Check sequence order first!",
          "debriefing": {
            "title": "ğŸ”¬ Filtration Multi-Ã‰tages ActivÃ©e!",
            "explanation": "Parfait! Vous avez activÃ© les 3 Ã©tages de filtration dans le bon ordre:\n\n1ï¸âƒ£ HEPA (High-Efficiency Particulate Air)\n   â†’ Capture 99.97% des particules â‰¥ 0.3 Î¼m\n   â†’ PoussiÃ¨res, pollens, bactÃ©ries, virus\n\n2ï¸âƒ£ CARBON (Charbon actif)\n   â†’ Absorbe COV (ComposÃ©s Organiques Volatils)\n   â†’ Odeurs, formaldÃ©hyde, benzÃ¨ne\n\n3ï¸âƒ£ UV-C (LumiÃ¨re ultraviolette 254nm)\n   â†’ Inactive virus et bactÃ©ries restants\n   â†’ StÃ©rilisation finale\n\nL'ORDRE est crucial: HEPA d'abord enlÃ¨ve les grosses particules qui satureraient le charbon actif.",
            "didYouKnow": "Les filtres HEPA ont Ã©tÃ© inventÃ©s pendant le Projet Manhattan (1940s) pour capturer les particules radioactives! Aujourd'hui on les trouve dans les salles blanches (fabrication de puces), les hÃ´pitaux (blocs opÃ©ratoires), les avions (renouvellement air cabine) et les aspirateurs haut de gamme.",
            "realWorld": "Dans un bloc opÃ©ratoire, l'air passe par filtre HEPA H14 (99.995% particules) + surpression +15 Pa. RÃ©sultat: < 1 particule/mÂ³ vs 35 millions/mÂ³ dans l'air extÃ©rieur urbain! La NASA utilise des salles ISO 1 (< 10 particules/mÂ³) pour assembler satellites.",
            "unlocked": "Console Air Quality Monitor accessible"
          }
        },
        {
          "id": "sequencePanel",
          "type": "panel",
          "name": "Filter Sequence Panel",
          "x": 3,
          "y": 6,
          "roleLock": "Analyst",
          "requires": ["multiValve_R2"],
          "panel": {
            "title": "ğŸ”¬ SÃ‰QUENCE ACTIVATION FILTRES",
            "text": "âš ï¸ PROCÃ‰DURE CRITIQUE - NE PAS SE TROMPER!\n\nğŸ“‹ ORDRE D'ACTIVATION OBLIGATOIRE:\n\n1ï¸âƒ£ Filtre A - HEPA (High-Efficiency Particulate Air)\n   â†’ Capte particules â‰¥ 0.3 Î¼m (poussiÃ¨re, pollens)\n   â†’ DOIT Ãªtre activÃ© EN PREMIER\n\n2ï¸âƒ£ Filtre C - CARBON (Charbon actif)\n   â†’ Absorbe COV et gaz\n   â†’ ProtÃ©gÃ© par HEPA contre saturation\n\n3ï¸âƒ£ Filtre B - UV-C (Ultraviolet 254nm)\n   â†’ StÃ©rilisation finale\n   â†’ Active EN DERNIER\n\nğŸ’¡ POURQUOI CET ORDRE?\nHEPA enlÃ¨ve d'abord les grosses particules\nâ†’ EmpÃªche saturation prÃ©maturÃ©e du charbon\nâ†’ UV stÃ©rilise l'air dÃ©jÃ  filtrÃ©\n\nğŸ“ CODE VALIDATION:\nInitiales dans l'ordre: A â†’ C â†’ B = ACB\n\nğŸ“¡ TRANSMETTEZ ce code Ã  l'Operator!",
            "code": "ACB"
          },
          "tooltip": "ğŸ”¬ SÃ©quence Filtres\nğŸ”’ AccÃ¨s: Analyst\nğŸ’¡ Lisez l'ordre et transmettez le code!\nğŸ”— PrÃ©requis: R2 complÃ©tÃ©"
        },
        {
          "id": "airQualityMonitor",
          "type": "console",
          "name": "Air Quality Monitor",
          "x": 9,
          "y": 6,
          "console": {
            "accept": "code3",
            "validFormatRegex": "^[A-Z]{3}$",
            "correctCode": "ACB"
          },
          "roleLock": "Operator",
          "cooldownMs": 250,
          "requires": ["sequence_R3"],
          "tooltip": "Air Quality Monitor - Operator only\nğŸ”— Requires: Filters activated in correct sequence",
          "debriefing": {
            "title": "âœ… QualitÃ© d'Air RestaurÃ©e!",
            "explanation": "Excellent! Le systÃ¨me de surveillance qualitÃ© d'air est opÃ©rationnel. Il surveille en temps rÃ©el:\n\nğŸ“Š Indicateurs:\nâ€¢ COâ‚‚ (cible: < 1000 ppm)\nâ€¢ PM2.5 particules fines (< 25 Î¼g/mÂ³)\nâ€¢ COV totaux (< 300 Î¼g/mÂ³)\nâ€¢ HumiditÃ© relative (40-60%)\nâ€¢ TempÃ©rature (20-23Â°C)\n\nLorsqu'un seuil est dÃ©passÃ©, le systÃ¨me ajuste automatiquement ventilation et filtration. La station peut maintenir un air sain 24/7!",
            "didYouKnow": "Dans une maison typique, l'air intÃ©rieur est 2 Ã  5 fois PLUS polluÃ© que l'air extÃ©rieur! Sources: meubles (formaldÃ©hyde), produits mÃ©nagers (COV), humiditÃ© (moisissures), cuisson (PM2.5). Solution simple: aÃ©rer 10 minutes matin + soir rÃ©duit les polluants de 70%!",
            "realWorld": "Selon l'OMS, la pollution de l'air intÃ©rieur cause 3.8 millions de dÃ©cÃ¨s/an, surtout dans les pays en dÃ©veloppement (cuisson au bois/charbon). CoÃ»t Ã©conomique: 2% du PIB mondial. Technologies Ã©mergentes: capteurs IoT connectÃ©s, IA qui optimise ventilation, plantes dÃ©polluantes (pothos, ficus).",
            "unlocked": "Sortie Emergency Exit dÃ©verrouillÃ©e"
          }
        },
        {
          "id": "doorR3",
          "type": "door",
          "name": "Exit Door",
          "x": 11,
          "y": 6,
          "open": false,
          "lockedBy": ["R3_complete"]
        }
      ],
      "puzzles": [
        {
          "id": "sequence_R3",
          "type": "sequence",
          "order": ["filterA", "filterB", "filterC"],
          "resetOnError": true,
          "lockMs": 3000,
          "windowMs": 5000
        },
        {
          "id": "infoSplit_R3",
          "type": "infoSplit",
          "sourcePanel": "sequencePanel",
          "targetConsole": "airQualityMonitor",
          "codeFormat": "AAA",
          "soloNote": true
        }
      ],
      "successCondition": "sequence_R3.success && airQualityMonitor.correct",
      "outputs": {
        "keys": ["K3"],
        "codePart": "7"
      },
      "pedagogy": {
        "title": "Multi-Stage Air Filtration",
        "lines": [
          "Modern air purification uses multiple filter stages:",
          "HEPA filters capture 99.97% of particles â‰¥0.3Î¼m (dust, pollen, bacteria).",
          "Activated carbon filters absorb VOCs and odors.",
          "UV-C light (254nm) inactivates viruses and bacteria.",
          "Correct sequence order prevents filter saturation and maximizes efficiency."
        ],
        "quiz": {
          "q": "What percentage of particles does a HEPA filter capture?",
          "choices": ["95%", "99%", "99.97%", "100%"],
          "correctIndex": 2
        },
        "techContext": "As a Tech, you activated the multi-stage filtration system in the correct sequence."
      },
      "hint": "Read the sequence panel carefully. The order matters for filter efficiency."
    },
    {
      "id": "EXIT",
      "name": "Emergency Exit",
      "grid": { "cols": 12, "rows": 8 },
      "spawn": { "x": 6, "y": 6 },
      "objects": [
        {
          "id": "finalDoor",
          "type": "door",
          "name": "Emergency Exit Door",
          "x": 6,
          "y": 2,
          "open": false,
          "lockedBy": ["finalCode"]
        },
        {
          "id": "exitPanel",
          "type": "panel",
          "name": "Exit Instructions",
          "x": 3,
          "y": 5,
          "roleLock": "Analyst",
          "panel": {
            "title": "Emergency Exit Protocol",
            "text": "EVACUATION CODE REQUIRED\n\nCombine all code parts collected from previous rooms.\nFormat: XXXX (4 digits)\n\nCode parts obtained:\nR1: [Part 1]\nR2: [Part 2]\nR3: [Part 3]",
            "code": "info"
          },
          "tooltip": "Exit Instructions - Analyst only"
        },
        {
          "id": "exitConsole",
          "type": "console",
          "name": "Exit Console",
          "x": 9,
          "y": 5,
          "console": {
            "accept": "finalCode",
            "validFormatRegex": "^[0-9]{4}$",
            "correctCode": "7347"
          },
          "roleLock": "Operator",
          "cooldownMs": 250,
          "tooltip": "Exit Console - Enter evacuation code"
        },
        {
          "id": "airQualityDisplay",
          "type": "panel",
          "name": "Final Air Quality Report",
          "x": 6,
          "y": 7,
          "panel": {
            "title": "Mission Success",
            "text": "âœ“ COâ‚‚ levels normalized: 450 ppm\nâœ“ Ventilation system: ACTIVE\nâœ“ Filtration system: OPERATIONAL\nâœ“ Air quality: EXCELLENT\n\nYou have successfully restored indoor air quality!",
            "code": "success"
          },
          "tooltip": "Air Quality Report"
        }
      ],
      "puzzles": [
        {
          "id": "finalCode_puzzle",
          "type": "infoSplit",
          "sourcePanel": "exitPanel",
          "targetConsole": "exitConsole",
          "codeFormat": "NNNN",
          "soloNote": true
        }
      ],
      "successCondition": "exitConsole.correct",
      "outputs": {
        "victory": true
      },
      "pedagogy": {
        "title": "Indoor Air Quality - Mission Complete",
        "lines": [
          "Congratulations! You've learned the fundamentals of indoor air quality management:",
          "â€¢ COâ‚‚ monitoring and threshold alerts (1000 ppm)",
          "â€¢ Mechanical ventilation systems and airflow control",
          "â€¢ Multi-stage air filtration (HEPA, Carbon, UV)",
          "â€¢ Importance of proper maintenance and monitoring",
          "",
          "Real-world impact:",
          "â€¢ Better air quality improves cognitive performance by 60%",
          "â€¢ Reduces respiratory illnesses and allergies",
          "â€¢ Essential for schools, offices, and homes",
          "",
          "Remember: Fresh air is not a luxury, it's a necessity!"
        ],
        "quiz": {
          "q": "What is the main benefit of good indoor air quality?",
          "choices": [
            "Lower energy costs",
            "Better health and cognitive performance",
            "Prettier rooms",
            "Louder ventilation"
          ],
          "correctIndex": 1
        },
        "allRolesContext": "As a team, you successfully restored indoor air quality through collaboration and problem-solving!"
      },
      "hint": "Combine the code parts from R1 (3), R2 (4), and R3 (7) with the initial digit 7."
    }
  ]
}
